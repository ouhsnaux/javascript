# 垃圾回收

1. 引用计数
2. 标记清除
3. 新老生代

## 引用计数

当一个对象引用数为0时回收。

循环引用的对象将一直存在，不能回收。

## 标记清除

标记所有对象，对从全局对象(window)可遍历的对象取消标记，回收被标记的对象。

会产生大量的磁盘空片段，后续难以使用

## 新生代 老生代

大部份对象的生命周期都很短，新生代以空间换时间，提升回收速度。

### 回收算法

新生代磁盘较小，分为 `from` 和 `to` 两个相同大小的部分。存放生命周期很短的对象。
老生代磁盘很大。存放生命周期很长的对象。

新声明一个对象，默认其生命很短，进入新生代（除非对象很大，无法放入新生代，此时直接进入老生代）。

新老生代都使用标记法确定是否可回收。

新生代回收时，将可回收的对象从from复制到to，然后对调from和to
老生代回收时，先标记清除，然后整理磁盘
当新生代体积超过25%时，将已经复制过一次的对象放入老生代

### 对比

| 新生代 | 老生代 |
| :-- | :-- |
| 存放生命周期短，体量小的对象 | 存放生命周期长，体量大的对象 |
| 回收频繁，速度快，磁盘只有一半有用 | 回收不频繁，速度较慢，磁盘利用率高 |

### 回收时机

* 一个宏任务或微任务运行完毕
* 磁盘不够
